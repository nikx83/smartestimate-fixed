/**
 * –§–∞–π–ª: /lib/technical-assignment/utils.ts
 * –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º
 * 
 * –û–ø–∏—Å–∞–Ω–∏–µ:
 * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
 * —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è. –í–∫–ª—é—á–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤,
 * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
 */

import type { 
  TechnicalAssignment,
  InteractiveWorkItem,
  NormativeQuote,
  EconomicJustification,
  SectionStatus
} from '@/types/technical-assignment';

// ============================================================================
// –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–¢–ê–ù–î–ê–†–¢–ù–´–• –¢–ï–ö–°–¢–û–í
// ============================================================================

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
 */
export function generateSafetyText(): string {
  return `–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–∑—ã—Å–∫–∞–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è:

‚Ä¢ –°–ü –†–ö 1.04-101-2012* "–¢–µ—Ö–Ω–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ. –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è"
‚Ä¢ –ü—Ä–∞–≤–∏–ª–∞–º–∏ –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞ –ø—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ –≥–µ–æ–ª–æ–≥–æ—Ä–∞–∑–≤–µ–¥–æ—á–Ω—ã—Ö —Ä–∞–±–æ—Ç
‚Ä¢ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –ø–æ–∂–∞—Ä–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –ü–ü–ë –†–ö

–û–ë–©–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –í—Å–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω—ã —Å–ø–µ—Ü–æ–¥–µ–∂–¥–æ–π, —Å–ø–µ—Ü–æ–±—É–≤—å—é –∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã
2. –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. –ë—É—Ä–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞
4. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±—É—Ä–æ–≤—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —ç–ª–µ–∫—Ç—Ä–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ª–∏—Ü –≤ –∑–æ–Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç

–ú–ï–†–´ –ü–†–ï–î–û–°–¢–û–†–û–ñ–ù–û–°–¢–ò:
‚Ä¢ –ü—Ä–∏ –±—É—Ä–µ–Ω–∏–∏ —Å–∫–≤–∞–∂–∏–Ω –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å—Ç–µ–Ω–æ–∫ –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –æ–±—Ä—É—à–µ–Ω–∏—è
‚Ä¢ –ü—Ä–∏ –æ—Ç–±–æ—Ä–µ –ø—Ä–æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞—â–∏—Ç–Ω—ã–µ –ø–µ—Ä—á–∞—Ç–∫–∏
‚Ä¢ –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ö–∏–º—Ä–µ–∞–∫—Ç–∏–≤–∞–º–∏ —Å–æ–±–ª—é–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É –æ–±—Ä–∞—â–µ–Ω–∏—é
‚Ä¢ –ò–º–µ—Ç—å –Ω–∞ —É—á–∞—Å—Ç–∫–µ –∞–ø—Ç–µ—á–∫—É –ø–µ—Ä–≤–æ–π –ø–æ–º–æ—â–∏ –∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–∂–∞—Ä–æ—Ç—É—à–µ–Ω–∏—è`;
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ –æ—Ö—Ä–∞–Ω–µ –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã
 */
export function generateEnvironmentalText(): string {
  return `–†–∞–±–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å:

‚Ä¢ –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –∫–æ–¥–µ–∫—Å–æ–º –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
‚Ä¢ –ó–∞–∫–æ–Ω–æ–º –†–ö "–û–± –æ—Ö—Ä–∞–Ω–µ –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã"
‚Ä¢ –°–∞–Ω–ü–∏–ù 1.03.001-12 "–°–∞–Ω–∏—Ç–∞—Ä–Ω–æ-—ç–ø–∏–¥–µ–º–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è"

–û–°–ù–û–í–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–Ω—É—é —Å—Ä–µ–¥—É
2. –ù–µ –¥–æ–ø—É—Å–∫–∞—Ç—å –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –ø–æ—á–≤, –≥—Ä—É–Ω—Ç–æ–≤—ã—Ö –≤–æ–¥ –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–≥–æ –≤–æ–∑–¥—É—Ö–∞
3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Ä–µ–∫—É–ª—å—Ç–∏–≤–∞—Ü–∏—é –Ω–∞—Ä—É—à–µ–Ω–Ω—ã—Ö –∑–µ–º–µ–ª—å –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–±–æ—Ç
4. –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –º—É—Å–æ—Ä –∏ –æ—Ç—Ö–æ–¥—ã –≤—ã–≤–æ–∑–∏—Ç—å –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞
5. –°–æ–±–ª—é–¥–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–±—Ä–∞—â–µ–Ω–∏—é —Å –æ–ø–∞—Å–Ω—ã–º–∏ –æ—Ç—Ö–æ–¥–∞–º–∏

–ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø –ü–û –û–•–†–ê–ù–ï –ü–†–ò–†–û–î–´:
‚Ä¢ –ë—É—Ä–µ–Ω–∏–µ —Å–∫–≤–∞–∂–∏–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±—Å–∞–¥–Ω—ã—Ö —Ç—Ä—É–± –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –≤–æ–¥–æ–Ω–æ—Å–Ω—ã—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–≤
‚Ä¢ –°–±–æ—Ä –∏ —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è –±—É—Ä–æ–≤—ã—Ö —Ä–∞—Å—Ç–≤–æ—Ä–æ–≤ –∏ —à–ª–∞–º–∞
‚Ä¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è –Ω–∞ —É—á–∞—Å—Ç–∫–∞—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç
‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç`;
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –æ —Å–æ—Å—Ç–∞–≤–µ –æ—Ç—á–µ—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
 */
export function generateReportingComposition(): string[] {
  return [
    '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –æ–± –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–∑—ã—Å–∫–∞–Ω–∏—è—Ö',
    '–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑—Ä–µ–∑—ã, –∫–∞—Ä—Ç—ã)',
    '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏—Å–ø—ã—Ç–∞–Ω–∏–π –≥—Ä—É–Ω—Ç–æ–≤',
    '–ñ—É—Ä–Ω–∞–ª—ã –±—É—Ä–æ–≤—ã—Ö –∏ –≥–æ—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç',
    '–ê–∫—Ç—ã –ø–æ–ª–µ–≤—ã—Ö —Ä–∞–±–æ—Ç –∏ –ø—Ä–∏—ë–º–∫–∏ —Å–∫–≤–∞–∂–∏–Ω',
    '–í–µ–¥–æ–º–æ—Å—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏ –≤—ã—Å–æ—Ç —Ç–æ—á–µ–∫ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π',
    '–ó–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –≥–µ–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞',
    '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–≤',
    '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ—Ç—á–µ—Ç–∞ (PDF, Word)',
  ];
}

// ============================================================================
// –ê–í–¢–û–ó–ê–ü–û–õ–ù–ï–ù–ò–ï –†–ê–ó–î–ï–õ–û–í
// ============================================================================

/**
 * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑—ã—Å–∫–∞–Ω–∏–π –ø–æ —Ç–∏–ø—É –æ–±—ä–µ–∫—Ç–∞
 */
export function generateMainTasks(objectType: string, geotechnicalCategory: string): string[] {
  const baseTasks = [
    '–ò–∑—É—á–µ–Ω–∏–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π –ø–ª–æ—â–∞–¥–∫–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞',
    '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∏–∑–∏–∫–æ-–º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –≥—Ä—É–Ω—Ç–æ–≤',
    '–û—Ü–µ–Ω–∫–∞ –Ω–µ—Å—É—â–µ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≥—Ä—É–Ω—Ç–æ–≤ –æ—Å–Ω–æ–≤–∞–Ω–∏—è',
    '–ò–∑—É—á–µ–Ω–∏–µ –≥–∏–¥—Ä–æ–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π',
  ];

  const categoryTasks: Record<string, string[]> = {
    'I': [
      '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π –ø–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–º',
    ],
    'II': [
      '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–≤',
      '–û—Ü–µ–Ω–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥—Ä—É–Ω—Ç–æ–≤ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è',
    ],
    'III': [
      '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏',
      '–ü—Ä–æ–≥–Ω–æ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π',
      '–û—Ü–µ–Ω–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤',
      '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–π –∑–∞—â–∏—Ç–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏',
    ],
  };

  return [...baseTasks, ...(categoryTasks[geotechnicalCategory] || [])];
}

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
 */
export function generateForecastProcesses(
  hazards: string[],
  hydrogeology: boolean
): string[] {
  const processes: string[] = [];

  if (hydrogeology) {
    processes.push('–ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –≥—Ä—É–Ω—Ç–æ–≤—ã—Ö –≤–æ–¥ –ø–æ–¥ –≤–ª–∏—è–Ω–∏–µ–º —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞');
    processes.push('–ü–æ–¥—Ç–æ–ø–ª–µ–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏');
  }

  if (hazards.includes('–ø—Ä–æ—Å–∞–¥–æ—á–Ω–æ—Å—Ç—å')) {
    processes.push('–†–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ—Å–∞–¥–æ—á–Ω—ã—Ö –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–π –ø—Ä–∏ –∑–∞–º–∞—á–∏–≤–∞–Ω–∏–∏');
  }

  if (hazards.includes('–ø—É—á–∏–Ω–∏—Å—Ç–æ—Å—Ç—å')) {
    processes.push('–ú–æ—Ä–æ–∑–Ω–æ–µ –ø—É—á–µ–Ω–∏–µ –≥—Ä—É–Ω—Ç–æ–≤ –≤ –∑–∏–º–Ω–∏–π –ø–µ—Ä–∏–æ–¥');
  }

  if (hazards.includes('–æ–ø–æ–ª–∑–Ω–∏')) {
    processes.push('–ê–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è –æ–ø–æ–ª–∑–Ω–µ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤');
  }

  if (hazards.includes('–∫–∞—Ä—Å—Ç')) {
    processes.push('–†–∞–∑–≤–∏—Ç–∏–µ –∫–∞—Ä—Å—Ç–æ–≤–æ-—Å—É—Ñ—Ñ–æ–∑–∏–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤');
  }

  // –í—Å–µ–≥–¥–∞
  processes.push('–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ-–¥–µ—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ –≥—Ä—É–Ω—Ç–æ–≤');

  return processes;
}

// ============================================================================
// –†–ê–ë–û–¢–ê –° –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ú–ò –≠–õ–ï–ú–ï–ù–¢–ê–ú–ò
// ============================================================================

/**
 * –ü–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Ä–∞–±–æ—Ç–∞–º
 */
export function calculateWorksStatistics(works: InteractiveWorkItem[]) {
  return {
    total: works.length,
    selected: works.filter(w => w.isSelected).length,
    mandatory: works.filter(w => w.category === 'mandatory').length,
    recommended: works.filter(w => w.category === 'recommended').length,
    optional: works.filter(w => w.category === 'optional').length,
    withNotes: works.filter(w => w.userNotes && w.userNotes.length > 0).length,
  };
}

/**
 * –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
 */
export function filterWorks(
  works: InteractiveWorkItem[],
  filters: {
    selected?: boolean;
    category?: string;
    module?: string;
    search?: string;
  }
): InteractiveWorkItem[] {
  return works.filter(work => {
    if (filters.selected !== undefined && work.isSelected !== filters.selected) {
      return false;
    }

    if (filters.category && work.category !== filters.category) {
      return false;
    }

    if (filters.module && work.module !== filters.module) {
      return false;
    }

    if (filters.search) {
      const searchLower = filters.search.toLowerCase();
      const matchesName = work.name.toLowerCase().includes(searchLower);
      const matchesDescription = work.description?.toLowerCase().includes(searchLower);
      
      if (!matchesName && !matchesDescription) {
        return false;
      }
    }

    return true;
  });
}

/**
 * –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç –ø–æ –º–æ–¥—É–ª—è–º
 */
export function groupWorksByModule(works: InteractiveWorkItem[]): Map<string, InteractiveWorkItem[]> {
  const grouped = new Map<string, InteractiveWorkItem[]>();

  works.forEach(work => {
    const module = work.module || '–ü—Ä–æ—á–∏–µ';
    if (!grouped.has(module)) {
      grouped.set(module, []);
    }
    grouped.get(module)!.push(work);
  });

  return grouped;
}

// ============================================================================
// –°–ë–û–† –ù–û–†–ú–ê–¢–ò–í–ù–´–• –°–°–´–õ–û–ö
// ============================================================================

/**
 * –ò–∑–≤–ª–µ—á—å –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏–∑ —Ä–∞–±–æ—Ç
 */
export function extractNormativeReferences(works: InteractiveWorkItem[]) {
  const allRefs = works
    .filter(w => w.isSelected)
    .flatMap(w => w.normativeQuotes || [])
    .map(q => q.document);

  // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
  const unique = Array.from(new Set(allRefs));

  // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø—É
  const spRK = unique.filter(doc => doc.startsWith('–°–ü –†–ö'));
  const gost = unique.filter(doc => doc.startsWith('–ì–û–°–¢'));
  const stRK = unique.filter(doc => doc.startsWith('–°–¢ –†–ö'));
  const other = unique.filter(doc => !spRK.includes(doc) && !gost.includes(doc) && !stRK.includes(doc));

  return { spRK, gost, stRK, other };
}

// ============================================================================
// –í–ê–õ–ò–î–ê–¶–ò–Ø –ò –ü–†–û–í–ï–†–ö–ê –ü–û–õ–ù–û–¢–´
// ============================================================================

/**
 * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å–µ–∫—Ü–∏–∏
 */
export function checkSectionCompleteness(
  section: any,
  requiredFields: string[]
): { status: SectionStatus; missing: string[] } {
  const missing: string[] = [];

  requiredFields.forEach(field => {
    const value = section?.[field];
    if (value === undefined || value === null || value === '') {
      missing.push(field);
    }
  });

  if (missing.length === 0) {
    return { status: 'complete', missing: [] };
  } else if (missing.length === requiredFields.length) {
    return { status: 'empty', missing };
  } else {
    return { status: 'partial', missing };
  }
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—â—É—é –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –¢–ó
 */
export function calculateOverallCompleteness(assignment: TechnicalAssignment): number {
  const sections = [
    assignment.generalInfo,
    assignment.objectCharacteristics,
    assignment.naturalConditions,
    assignment.surveyPurpose,
    assignment.works,
    assignment.initialData,
    assignment.productionRequirements,
    assignment.safety,
    assignment.environmental,
    assignment.forecast,
    assignment.reporting,
    assignment.customer,
  ];

  let totalFields = 0;
  let filledFields = 0;

  sections.forEach(section => {
    if (section) {
      Object.entries(section).forEach(([key, value]) => {
        totalFields++;
        if (value !== undefined && value !== null && value !== '') {
          // –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
          if (Array.isArray(value)) {
            if (value.length > 0) filledFields++;
          } else {
            filledFields++;
          }
        }
      });
    }
  });

  return Math.round((filledFields / totalFields) * 100);
}

// ============================================================================
// –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ò –≠–ö–°–ü–û–†–¢
// ============================================================================

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—É –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
 */
export function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('ru-RU', {
    day: '2-digit',
    month: 'long',
    year: 'numeric',
  }).format(date);
}

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞
 */
export function generateDocumentTitle(assignment: TechnicalAssignment): string {
  return `–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï\n–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–∑—ã—Å–∫–∞–Ω–∏–π\n–¥–ª—è –æ–±—ä–µ–∫—Ç–∞: "${assignment.generalInfo.projectName}"`;
}

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –¢–ó
 */
export function generateExecutiveSummary(assignment: TechnicalAssignment): string {
  const { objectCharacteristics, works, statistics } = assignment;
  
  return `–û–±—ä–µ–∫—Ç –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ ${objectCharacteristics.geotechnicalCategory} –≥–µ–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, ` +
    `${objectCharacteristics.complexityCategory} –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π, ` +
    `${objectCharacteristics.responsibilityLevel} —É—Ä–æ–≤–Ω—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.\n\n` +
    `–î–ª—è –∏–∑—ã—Å–∫–∞–Ω–∏–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ ${statistics.selectedWorks} –≤–∏–¥–æ–≤ —Ä–∞–±–æ—Ç, ` +
    `–∏–∑ –Ω–∏—Ö ${statistics.mandatoryWorks} –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ ${statistics.recommendedWorks} —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö.`;
}

// ============================================================================
// –ò–ö–û–ù–ö–ò –î–õ–Ø –ö–ê–¢–ï–ì–û–†–ò–ô –ò –°–¢–ê–¢–£–°–û–í
// ============================================================================

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∏–∫–æ–Ω–∫—É –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã
 */
export function getCategoryIcon(category: string): string {
  const icons: Record<string, string> = {
    'mandatory': 'üî¥',
    'recommended': 'üü°',
    'optional': '‚ö™',
    'reference': 'üîµ',
  };
  return icons[category] || '‚ö´';
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∏–∫–æ–Ω–∫—É –¥–ª—è –º–æ–¥—É–ª—è
 */
export function getModuleIcon(module: string): string {
  const icons: Record<string, string> = {
    '—Ç–æ–ø–æ–≥—Ä–∞—Ñ–æ-–≥–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–∏–µ': 'üìç',
    '–±—É—Ä–æ–≤—ã–µ': '‚õèÔ∏è',
    '–≥–æ—Ä–Ω—ã–µ-–≤—ã—Ä–∞–±–æ—Ç–∫–∏': 'üèîÔ∏è',
    '–ø–æ–ª–µ–≤—ã–µ-–∏—Å–ø—ã—Ç–∞–Ω–∏—è': 'üî¨',
    '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ': 'üß™',
    '–≥–∏–¥—Ä–æ–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ': 'üíß',
    '–≥–µ–æ—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ': 'üì°',
    '—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ': 'üåø',
    '–∫–∞–º–µ—Ä–∞–ª—å–Ω—ã–µ': 'üìã',
  };
  return icons[module] || 'üìÑ';
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
 */
export function getCategoryColor(category: string): string {
  const colors: Record<string, string> = {
    'mandatory': 'text-red-600 bg-red-50 border-red-200',
    'recommended': 'text-yellow-600 bg-yellow-50 border-yellow-200',
    'optional': 'text-gray-600 bg-gray-50 border-gray-200',
    'reference': 'text-blue-600 bg-blue-50 border-blue-200',
  };
  return colors[category] || 'text-gray-600 bg-gray-50 border-gray-200';
}
