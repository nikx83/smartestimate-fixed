/**
 * Файл: section46-ground-penetrating-radar.ts
 * Назначение: Георадиолокационное профилирование (георадар, ГПР)
 */

import type { 
  InstructionBlock, 
  GeologicalInput, 
  WorkItem 
} from './types';

/**
 * Блок 46.1: Георадиолокация (ГПР)
 */
export const block_46_01_gpr: InstructionBlock = {
  id: 'block-46-01-gpr',
  section: 'Раздел 46: Георадар (ГПР)',
  title: 'Георадиолокационное профилирование',
  description: 'Детальное изучение верхней части разреза радарным методом',
  priority: 35,
  tags: ['геофизика', 'георадар', 'ГПР'],
  
  condition: (input: GeologicalInput) => {
    return input.requiresGeophysics === true ||
           input.hasUndergroundUtilities === true ||
           input.hasArchaeologicalValue === true;
  },
  
  variants: [
    {
      id: 'variant-gpr-standard',
      priority: 'РЕКОМЕНДУЕМЫЙ',
      normative: {
        document: 'ГОСТ Р 50544-2009',
        section: 'Методы георадиолокационных исследований',
        priority: 'РЕКОМЕНДУЕМЫЙ'
      },
      recommendation:
        '**ГЕОРАДИОЛОКАЦИЯ (ГПР):**\n\n' +
        
        '**1. ФИЗИЧЕСКИЕ ОСНОВЫ:**\n' +
        '- Излучение коротких электромагнитных импульсов\n' +
        '- Приём отражённых сигналов\n' +
        '- Частота: 25-2500 МГц\n' +
        '- Скорость распространения: v = c / √εr\n' +
        '- c - скорость света (3×10⁸ м/с)\n' +
        '- εr - диэлектрическая проницаемость\n\n' +
        
        '**2. ТИПЫ АНТЕНН:**\n\n' +
        
        '**Низкочастотные (25-100 МГц):**\n' +
        '- Глубинность: 10-30 м\n' +
        '- Разрешение: низкое (~1 м)\n' +
        '- Применение: поиск кровли скальных пород, карста\n\n' +
        
        '**Среднечастотные (200-400 МГц):**\n' +
        '- Глубинность: 3-10 м\n' +
        '- Разрешение: среднее (~0.3 м)\n' +
        '- Применение: инженерная геология, коммуникации\n' +
        '- **СТАНДАРТ для изысканий**\n\n' +
        
        '**Высокочастотные (900-2500 МГц):**\n' +
        '- Глубинность: 0.5-3 м\n' +
        '- Разрешение: высокое (~0.05 м)\n' +
        '- Применение: контроль дорожных покрытий, археология\n\n' +
        
        '**3. МЕТОДИКА ПОЛЕВЫХ РАБОТ:**\n\n' +
        
        '**А. Непрерывное профилирование:**\n' +
        '- Антенна перемещается вдоль профиля\n' +
        '- Запись через 0.1-0.5 м\n' +
        '- Скорость: 3-5 км/час (пешком)\n' +
        '- Производительность: 5-10 км/день\n\n' +
        
        '**Б. Сеть профилей:**\n' +
        '- Продольные и поперечные\n' +
        '- Сетка: 5×5 м или 10×10 м\n' +
        '- Для 3D-интерпретации\n\n' +
        
        '**4. ГЛУБИННОСТЬ И РАЗРЕШЕНИЕ:**\n\n' +
        
        '**Зависимость от частоты:**\n' +
        '```\n' +
        'Разрешение (λ/4):\n' +
        '100 МГц → λ ≈ 1.5 м → разрешение ~0.4 м\n' +
        '400 МГц → λ ≈ 0.4 м → разрешение ~0.1 м\n' +
        '1000 МГц → λ ≈ 0.15 м → разрешение ~0.04 м\n' +
        '```\n\n' +
        
        '**Зависимость от грунтов:**\n' +
        '- Сухие пески: глубина до 15 м (низкое затухание)\n' +
        '- Суглинки: глубина 5-8 м\n' +
        '- Глины влажные: глубина 2-4 м (высокое затухание)\n' +
        '- Скальные: глубина 10-20 м\n\n' +
        
        '**5. ДИЭЛЕКТРИЧЕСКАЯ ПРОНИЦАЕМОСТЬ εr:**\n\n' +
        
        '**Типичные значения:**\n' +
        '- Воздух: εr = 1\n' +
        '- Лёд: εr = 3-4\n' +
        '- Песок сухой: εr = 3-6\n' +
        '- Песок влажный: εr = 10-30\n' +
        '- Суглинок: εr = 10-20\n' +
        '- Глина: εr = 15-40\n' +
        '- Вода пресная: εr = 80\n' +
        '- Бетон: εr = 6-8\n' +
        '- Металл: εr → ∞ (полное отражение)\n\n' +
        
        '**Расчёт глубины объекта:**\n' +
        '```\n' +
        'h = (v × t) / 2\n' +
        '\n' +
        'где:\n' +
        'v = c / √εr - скорость распространения\n' +
        't - время запаздывания отражения, нс\n' +
        '```\n\n' +
        
        '**6. ОБРАБОТКА ДАННЫХ:**\n\n' +
        
        '**Этапы обработки:**\n' +
        '1. Фильтрация шумов\n' +
        '2. Регулировка усиления (AGC)\n' +
        '3. Миграция (фокусировка дифракций)\n' +
        '4. Определение скорости v по гиперболам\n' +
        '5. Пересчёт времени в глубину\n' +
        '6. Интерпретация аномалий\n\n' +
        
        '**ПО:** Prism2, RadExplorer, ReflexW, GeoReader\n\n' +
        
        '**7. РЕШАЕМЫЕ ЗАДАЧИ:**\n\n' +
        
        '**А. Инженерная геология:**\n' +
        '- Выявление границ слоёв (контрастных по εr)\n' +
        '- Определение УГВ (яркий рефлектор)\n' +
        '- Карст, пустоты (аномалии низкой амплитуды)\n' +
        '- Линзы песка в глинах\n' +
        '- Зоны разуплотнения, трещины\n\n' +
        
        '**Б. Поиск коммуникаций:**\n' +
        '- Трубы (металл - полное отражение, пластик - гипербола)\n' +
        '- Кабели (гиперболы)\n' +
        '- Колодцы\n' +
        '- Туннели\n\n' +
        
        '**В. Контроль качества:**\n' +
        '- Толщина дорожных слоёв\n' +
        '- Пустоты под покрытием\n' +
        '- Качество уплотнения\n\n' +
        
        '**Г. Археология:**\n' +
        '- Фундаменты сооружений\n' +
        '- Погребения\n' +
        '- Культурные слои\n\n' +
        
        '**8. ПРЕИМУЩЕСТВА ГПР:**\n' +
        '- Очень высокая производительность (до 10 км/день)\n' +
        '- Высокое разрешение (до 5 см)\n' +
        '- Непрерывный разрез\n' +
        '- Неразрушающий метод\n' +
        '- Работа в любое время года\n' +
        '- Портативность оборудования\n' +
        '- 3D-визуализация\n\n' +
        
        '**9. ОГРАНИЧЕНИЯ:**\n' +
        '- Малая глубинность во влажных глинах (2-4 м)\n' +
        '- Не работает в солёных грунтах и водах\n' +
        '- Затруднена интерпретация в неоднородных средах\n' +
        '- Помехи от металлических объектов\n' +
        '- Требует калибровки по скважинам\n\n' +
        
        '**10. КОЛИЧЕСТВО ПРОФИЛЕЙ:**\n\n' +
        
        '**Для площадных объектов:**\n' +
        '- Сеть 10×10 м (детальные работы)\n' +
        '- Сеть 20×20 м (рекогносцировка)\n\n' +
        
        '**Для линейных объектов:**\n' +
        '- Вдоль оси трассы (2-3 линии)\n' +
        '- Поперечные профили через 50-100 м\n\n' +
        
        '**11. СИНЕРГИЯ С ДРУГИМИ МЕТОДАМИ:**\n' +
        '- ГПР + ВЭЗ = полная информация (глубина + литология)\n' +
        '- ГПР + бурение = калибровка скоростей\n' +
        '- ГПР + зондирование = комплексная оценка\n\n' +
        
        '**ВАЖНО:** ГПР - метод №1 для изучения верхних 5-10 м разреза',
      
      recommendedValues: {
        frequency: {
          value: 300,
          unit: 'МГц',
          explanation: 'Типичная частота для изысканий'
        },
        depth: {
          value: 8,
          unit: 'м',
          explanation: 'Ожидаемая глубинность'
        },
        productivity: {
          value: 5,
          unit: 'км/день',
          explanation: 'Производительность'
        }
      }
    }
  ],
  
  calculateValues: (input: GeologicalInput) => {
    const area = input.buildingArea || 0;
    const linear = input.linearLength || 0;
    
    let profileLength = 0;
    
    if (area > 0) {
      // Площадной объект - сетка профилей
      const sideLength = Math.sqrt(area);
      const numberOfProfiles = Math.ceil(sideLength / 20);
      profileLength = numberOfProfiles * sideLength * 2; // продольные + поперечные
    } else if (linear > 0) {
      // Линейный объект
      profileLength = linear * 2; // 2 параллельные линии
    }
    
    return {
      gprProfiles: {
        value: profileLength,
        unit: 'п.м',
        explanation: 'Общая длина георадарных профилей',
        confidence: 85
      },
      estimatedDepth: {
        value: 8,
        unit: 'м',
        explanation: 'Ожидаемая глубинность при 300 МГц',
        confidence: 80
      }
    };
  },
  
  generateWorks: (input: GeologicalInput) => {
    const works: WorkItem[] = [];
    const values = block_46_01_gpr.calculateValues!(input);
    
    if (values.gprProfiles.value === 0) {
      return works;
    }
    
    const length = typeof values.gprProfiles.value === 'number'
      ? values.gprProfiles.value
      : parseFloat(String(values.gprProfiles.value));
    
    works.push({
      workId: 'GEOPH-GPR-01',
      name: 'Георадиолокационное профилирование (ГПР)',
      description: 
        'Непрерывное профилирование антенной 200-400 МГц. ' +
        'Обработка данных, построение радарограмм, интерпретация',
      unit: 'п.м',
      quantity: length,
      category: 'recommended',
      module: 'geological',
      priority: 'РЕКОМЕНДУЕМЫЙ',
      normativeBase: 'ГОСТ Р 50544-2009',
      tags: ['геофизика', 'георадар'],
      priceTableCode: '1602-0604'
    });
    
    return works;
  }
};

export const section46_blocks: InstructionBlock[] = [
  block_46_01_gpr
];

export default section46_blocks;
