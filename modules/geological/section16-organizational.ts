/**
 * Файл: /modules/geological/section13-organizational.ts
 * Назначение: Организационные блоки инструкции - камеральная обработка, 
 *             лицензирование, контроль качества, стадийность
 * 
 * ПРИМЕЧАНИЕ: Это Разделы 16-20 инструкции, файл называется section13
 * 
 * Описание:
 * Блоки для организационных и методических аспектов изысканий:
 * - Раздел 16: Камеральная обработка и технический отчёт
 * - Раздел 17: Лицензирование и квалификация
 * - Раздел 18: Контроль качества
 * - Раздел 19: Стадийность изысканий
 * - Раздел 20: Критерии успеха
 * 
 * Эти блоки носят справочный характер и включаются автоматически
 */

import type { InstructionBlock, GeologicalInput, InstructionVariant, WorkItem } from '../rules-engine/types';

// ============================================================================
// РАЗДЕЛ 16: КАМЕРАЛЬНАЯ ОБРАБОТКА И ТЕХНИЧЕСКИЙ ОТЧЁТ
// ============================================================================

/**
 * Блок 16.1: Этапы камеральной обработки
 */
export const block_16_01_processing_stages: InstructionBlock = {
  id: 'block-16-01-processing-stages',
  section: 'Раздел 16: Камеральная обработка',
  title: 'Этапы камеральной обработки',
  description: 'Текущая и окончательная обработка материалов',
  priority: 160,
  tags: ['камеральная', 'обработка', 'организация'],
  
  condition: () => true, // Всегда включается
  
  variants: [
    {
      id: 'variant-mandatory-sp-rk-102',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'СП РК 1.02-102-2014',
        section: 'п. 5.21',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'Камеральная обработка выполняется в два этапа:\n\n' +
        '**ТЕКУЩАЯ ОБРАБОТКА** (в процессе полевых работ):\n' +
        '- Систематизация записей маршрутных наблюдений\n' +
        '- Составление колонок горных выработок\n' +
        '- Предварительные инженерно-геологические разрезы\n' +
        '- Карта фактического материала\n' +
        '- Каталоги выработок и образцов\n\n' +
        '**ОКОНЧАТЕЛЬНАЯ ОБРАБОТКА** (после лабораторных исследований):\n' +
        '- Уточнение предварительных материалов\n' +
        '- Статистическая обработка результатов\n' +
        '- Выделение инженерно-геологических элементов (ИГЭ)\n' +
        '- Определение нормативных и расчётных характеристик грунтов\n' +
        '- Составление технического отчёта',
      note: 'Справочная информация для организации работ'
    }
  ],
  
  generateWorks: () => {
    return [
      {
        workId: 'processing-current',
        name: 'Текущая камеральная обработка',
        category: 'mandatory',
        module: 'geological',
        quantity: 1,
        unit: 'комплекс',
        normativeBase: 'СП РК 1.02-102-2014, п. 5.21',
        description: 'Систематизация полевых материалов, предварительные разрезы',
        priority: 'СПРАВОЧНЫЙ',
        tags: ['камеральная', 'текущая']
      },
      {
        workId: 'processing-final',
        name: 'Окончательная камеральная обработка',
        category: 'mandatory',
        module: 'geological',
        quantity: 1,
        unit: 'комплекс',
        normativeBase: 'СП РК 1.02-102-2014, п. 5.21',
        description: 'Статобработка, выделение ИГЭ, нормативные характеристики',
        priority: 'СПРАВОЧНЫЙ',
        tags: ['камеральная', 'окончательная']
      }
    ];
  }
};

/**
 * Блок 16.2: Состав технического отчёта
 */
export const block_16_02_report_composition: InstructionBlock = {
  id: 'block-16-02-report-composition',
  section: 'Раздел 16: Камеральная обработка',
  title: 'Состав технического отчёта',
  description: 'Текстовая и графическая части отчёта',
  priority: 161,
  tags: ['отчёт', 'документация', 'организация'],
  
  condition: () => true, // Всегда включается
  
  variants: [
    {
      id: 'variant-mandatory-sp-rk-102',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'СП РК 1.02-102-2014',
        section: 'п. 4.13',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'Технический отчёт должен содержать:\n\n' +
        '**ТЕКСТОВАЯ ЧАСТЬ:**\n' +
        '1. Общие сведения о работах и объекте\n' +
        '2. Природные условия района работ\n' +
        '3. Геоморфологические условия\n' +
        '4. Геологическое строение\n' +
        '5. Гидрогеологические условия\n' +
        '6. Специфические грунты и опасные процессы\n' +
        '7. Физико-механические свойства грунтов\n' +
        '8. Оценка инженерно-геологических условий\n' +
        '9. Рекомендации по проектированию\n' +
        '10. Прогноз изменений условий\n\n' +
        '**ГРАФИЧЕСКИЕ ПРИЛОЖЕНИЯ:**\n' +
        '- Схема расположения выработок (план масштаба 1:500-1:2000)\n' +
        '- Инженерно-геологические разрезы\n' +
        '- Карта инженерно-геологических условий\n' +
        '- Карта изогипс подземных вод (при наличии)\n' +
        '- Схемы полевых испытаний\n' +
        '- Фотографии керна и обнажений',
      note: 'Минимальный обязательный состав отчёта'
    },
    {
      id: 'variant-rules',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'Правила осуществления инженерно-геологических изысканий',
        section: 'п. 6',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'Дополнительно к текстовой части прилагаются:\n' +
        '- Акт приёмки полевых работ\n' +
        '- Протоколы лабораторных исследований\n' +
        '- Ведомости физико-механических свойств грунтов\n' +
        '- Журналы буровых работ',
      note: 'Согласно Правилам РК'
    }
  ],
  
  generateWorks: () => {
    return [
      {
        workId: 'report-compilation',
        name: 'Составление технического отчёта',
        category: 'mandatory',
        module: 'geological',
        quantity: 1,
        unit: 'отчёт',
        normativeBase: 'СП РК 1.02-102-2014, п. 4.13; Правила, п. 6',
        description: 'Текстовая и графическая части, все приложения',
        priority: 'СПРАВОЧНЫЙ',
        tags: ['отчёт', 'документация']
      }
    ];
  }
};

/**
 * Блок 16.3: Специальные требования для гидроэнергетики
 */
export const block_16_03_hydro_requirements: InstructionBlock = {
  id: 'block-16-03-hydro-report-requirements',
  section: 'Раздел 16: Камеральная обработка',
  title: 'Специальные требования к отчёту для ГЭС',
  description: 'Дополнительные разделы для гидроэнергетических объектов',
  priority: 162,
  tags: ['отчёт', 'гидроэнергетика', 'ВСН'],
  
  condition: (input: GeologicalInput) => {
    return (
      input.objectType?.toLowerCase().includes('гэс') ||
      input.objectType?.toLowerCase().includes('плотин') ||
      input.objectType?.toLowerCase().includes('гидроэнергет')
    );
  },
  
  variants: [
    {
      id: 'variant-vsn',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'ВСН 34.2-88',
        section: 'п. 5.9',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'Для гидроэнергетических объектов технический отчёт дополнительно должен содержать:\n' +
        '- Классификацию пород по группам сохранности (шкала сохранности массива)\n' +
        '- Геолого-структурную модель массива пород основания плотины\n' +
        '- Прогноз изменения свойств пород при разгрузке (вскрытие котлована)\n' +
        '- Характеристики для расчёта фильтрации через тело и основание плотины\n' +
        '- Рекомендации по инженерной защите (противофильтрационные завесы, дренаж)',
      note: 'Специфика гидротехнических сооружений'
    }
  ],
  
  generateWorks: (input: GeologicalInput) => {
    return [
      {
        workId: 'hydro-report-special',
        name: 'Специальные разделы отчёта для ГЭС',
        category: 'mandatory',
        module: 'geological',
        quantity: 1,
        unit: 'комплекс',
        normativeBase: 'ВСН 34.2-88, п. 5.9',
        description: 'Сохранность пород, фильтрация, геолого-структурная модель',
        priority: 'СПРАВОЧНЫЙ',
        tags: ['отчёт', 'ГЭС']
      }
    ];
  }
};

// ============================================================================
// РАЗДЕЛ 17: ЛИЦЕНЗИРОВАНИЕ И КВАЛИФИКАЦИЯ
// ============================================================================

/**
 * Блок 17.1: Программа изысканий
 */
export const block_17_01_program: InstructionBlock = {
  id: 'block-17-01-investigation-program',
  section: 'Раздел 17: Организация изысканий',
  title: 'Программа изысканий',
  description: 'Разработка программы на основе технического задания',
  priority: 170,
  tags: ['программа', 'организация'],
  
  condition: () => true,
  
  variants: [
    {
      id: 'variant-sp-rk',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'СП РК 1.02-102-2014',
        section: 'п. 4.6',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'На основе технического задания заказчика составляется Программа изысканий, включающая:\n' +
        '1. Цели и задачи изысканий\n' +
        '2. Характеристика изученности территории (фондовые материалы)\n' +
        '3. Обоснование состава и объёмов работ\n' +
        '4. Методика и технология выполнения работ\n' +
        '5. Требования к качеству работ\n' +
        '6. Перечень отчётных материалов\n' +
        '7. Сроки и этапы выполнения',
      note: 'Программа утверждается заказчиком перед началом работ'
    }
  ],
  
  generateWorks: () => []
};

// ============================================================================
// РАЗДЕЛ 18: КОНТРОЛЬ КАЧЕСТВА
// ============================================================================

/**
 * Блок 18.1: Контроль качества полевых работ
 */
export const block_18_01_field_quality: InstructionBlock = {
  id: 'block-18-01-field-quality-control',
  section: 'Раздел 18: Контроль качества',
  title: 'Контроль качества полевых работ',
  description: 'Требования к контролю качества в полевых условиях',
  priority: 180,
  tags: ['контроль', 'качество', 'полевые'],
  
  condition: () => true,
  
  variants: [
    {
      id: 'variant-sp-rk',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'СП РК 1.02-102-2014',
        section: 'п. 4.9',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'Контроль качества полевых работ включает проверку:\n' +
        '- Соответствия фактических работ Программе изысканий\n' +
        '- Правильности геологической документации выработок\n' +
        '- Качества отбора образцов (монолиты, нарушенная структура)\n' +
        '- Точности геодезической привязки выработок\n' +
        '- Полноты полевых описаний грунтов',
      note: 'Контроль осуществляется начальником партии'
    }
  ],
  
  generateWorks: () => []
};

/**
 * Блок 18.2: Контроль качества лабораторных работ
 */
export const block_18_02_lab_quality: InstructionBlock = {
  id: 'block-18-02-lab-quality-control',
  section: 'Раздел 18: Контроль качества',
  title: 'Контроль качества лабораторных работ',
  description: 'Требования к контролю качества испытаний',
  priority: 181,
  tags: ['контроль', 'качество', 'лаборатория'],
  
  condition: () => true,
  
  variants: [
    {
      id: 'variant-gost',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'ГОСТ 30416-2012',
        section: 'разделы 5-6',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'Контроль качества лабораторных работ включает:\n' +
        '- Соблюдение стандартов испытаний (ГОСТ)\n' +
        '- Калибровку измерительного оборудования (не реже 1 раза в год)\n' +
        '- Повторные определения - не менее 3% от общего объёма\n' +
        '- Ведение журналов испытаний\n' +
        '- Условия хранения образцов (температура, влажность)',
      note: 'Лаборатория должна иметь аккредитацию'
    }
  ],
  
  generateWorks: () => []
};

// ============================================================================
// РАЗДЕЛ 19: СТАДИЙНОСТЬ ИЗЫСКАНИЙ
// ============================================================================

/**
 * Блок 19.1: Предпроектная стадия
 */
export const block_19_01_predesign: InstructionBlock = {
  id: 'block-19-01-predesign-stage',
  section: 'Раздел 19: Стадийность изысканий',
  title: 'Изыскания для предпроектной документации',
  description: 'Объём работ на предпроектной стадии',
  priority: 190,
  tags: ['стадия', 'предпроект'],
  
  condition: (input: GeologicalInput) => {
    return input.designStage === 'предпроектная' || input.designStage === 'ТЭО';
  },
  
  variants: [
    {
      id: 'variant-rules',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'Правила осуществления инженерно-геологических изысканий',
        section: 'п. 18',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'На предпроектной стадии (ТЭО) изыскания должны обеспечить получение материалов для:\n' +
        '- Компоновки зданий и сооружений на площадке\n' +
        '- Выбора конструктивных решений фундаментов\n' +
        '- Составления генерального плана\n' +
        '- Разработки мероприятий инженерной защиты\n' +
        '- Проекта организации строительства\n\n' +
        'Плотность выработок может быть уменьшена на 20-30% по сравнению с рабочей стадией',
      note: 'Достаточно для принятия принципиальных решений'
    }
  ],
  
  generateWorks: () => []
};

/**
 * Блок 19.2: Рабочая документация
 */
export const block_19_02_working: InstructionBlock = {
  id: 'block-19-02-working-stage',
  section: 'Раздел 19: Стадийность изысканий',
  title: 'Изыскания для рабочей документации',
  description: 'Детализация на стадии рабочего проекта',
  priority: 191,
  tags: ['стадия', 'рабочая'],
  
  condition: (input: GeologicalInput) => {
    return input.designStage === 'рабочая' || input.designStage === 'РД';
  },
  
  variants: [
    {
      id: 'variant-rules',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'Правила осуществления инженерно-геологических изысканий',
        section: 'п. 21-23',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'На стадии рабочей документации необходимо детализировать и уточнить:\n' +
        '- Инженерно-геологические условия конкретных участков размещения сооружений\n' +
        '- Прогноз изменений в период строительства и эксплуатации\n' +
        '- Окончательное выделение инженерно-геологических элементов (ИГЭ)\n' +
        '- Нормативные и расчётные показатели свойств грунтов\n' +
        '- Количественные характеристики опасных процессов\n\n' +
        'Плотность выработок - в соответствии с полными нормами',
      note: 'Материалы должны быть достаточны для окончательного проектирования'
    }
  ],
  
  generateWorks: () => []
};

// ============================================================================
// РАЗДЕЛ 20: КРИТЕРИИ УСПЕХА
// ============================================================================

/**
 * Блок 20.1: Критерии качественного ТЗ
 */
export const block_20_01_quality_criteria: InstructionBlock = {
  id: 'block-20-01-quality-criteria',
  section: 'Раздел 20: Критерии успеха',
  title: 'Критерии качественного технического задания',
  description: 'Показатели успешности формирования ТЗ',
  priority: 200,
  tags: ['критерии', 'качество'],
  
  condition: () => true,
  
  variants: [
    {
      id: 'variant-general',
      priority: 'СПРАВОЧНЫЙ',
      normative: {
        document: 'Все нормативные документы РК',
        section: 'общие требования',
        priority: 'СПРАВОЧНЫЙ'
      },
      recommendation: 'Техническое задание считается качественным, если выполнены критерии:\n\n' +
        '1. **Однозначность**: На основе инструкции можно однозначно сгенерировать список работ\n\n' +
        '2. **Нормативное обоснование**: Каждый пункт имеет чёткое нормативное обоснование из документов РК\n\n' +
        '3. **Логическая связь**: Рекомендации логически вытекают из входных параметров проекта\n\n' +
        '4. **Полнота охвата**: Учтены все виды работ, необходимые для конкретного объекта\n\n' +
        '5. **Соответствие иерархии**: Соблюдена иерархия нормативных документов РК:\n' +
        '   1) Правила осуществления ИГИ (2020)\n' +
        '   2) СН РК (Строительные нормы)\n' +
        '   3) СП РК (Своды правил)\n' +
        '   4) СТ РК (Стандарты)\n' +
        '   5) ГОСТ\n' +
        '   6) ВСН (только для гидроэнергетики)',
      note: 'Принцип: при наличии нескольких вариантов система предоставляет все с указанием приоритета'
    }
  ],
  
  generateWorks: () => []
};

// ============================================================================
// ЭКСПОРТ БЛОКОВ РАЗДЕЛА 16-20 (файл section13)
// ============================================================================

export const section13Blocks: InstructionBlock[] = [
  // Раздел 16: Камеральная обработка
  block_16_01_processing_stages,
  block_16_02_report_composition,
  block_16_03_hydro_requirements,
  
  // Раздел 17: Организация
  block_17_01_program,
  
  // Раздел 18: Контроль качества
  block_18_01_field_quality,
  block_18_02_lab_quality,
  
  // Раздел 19: Стадийность
  block_19_01_predesign,
  block_19_02_working,
  
  // Раздел 20: Критерии успеха
  block_20_01_quality_criteria
];

export default section13Blocks;
