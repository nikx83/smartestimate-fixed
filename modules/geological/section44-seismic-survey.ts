/**
 * Файл: section44-seismic-survey.ts
 * Назначение: Сейсморазведочные работы
 */

import type { 
  InstructionBlock, 
  GeologicalInput, 
  WorkItem 
} from './types';

/**
 * Блок 44.1: Сейсморазведка методом преломленных волн
 */
export const block_44_01_seismic_refraction: InstructionBlock = {
  id: 'block-44-01-seismic-refraction',
  section: 'Раздел 44: Сейсморазведка',
  title: 'Сейсморазведка методом преломленных волн (МПВ)',
  description: 'Определение глубин залегания и свойств грунтов',
  priority: 32,
  tags: ['геофизика', 'сейсморазведка', 'МПВ'],
  
  condition: (input: GeologicalInput) => {
    return input.requiresGeophysics === true ||
           input.buildingArea > 5000 ||
           input.linearLength !== undefined;
  },
  
  variants: [
    {
      id: 'variant-seismic-standard',
      priority: 'РЕКОМЕНДУЕМЫЙ',
      normative: {
        document: 'СП РК 1.02-102-2014',
        section: 'Геофизические методы',
        priority: 'РЕКОМЕНДУЕМЫЙ'
      },
      recommendation:
        '**СЕЙСМОРАЗВЕДКА МПВ:**\n\n' +
        
        '**1. НАЗНАЧЕНИЕ:**\n' +
        '- Определение глубины залегания слоёв\n' +
        '- Определение скоростей продольных волн Vp\n' +
        '- Выявление скальных грунтов и кровли коренных пород\n' +
        '- Определение мощности рыхлых отложений\n' +
        '- Оценка динамических модулей упругости\n\n' +
        
        '**2. ФИЗИЧЕСКИЕ ОСНОВЫ:**\n\n' +
        
        '**Закон Снеллиуса:**\n' +
        '```\n' +
        'sin(i₁) / V₁ = sin(i₂) / V₂\n' +
        '\n' +
        'где:\n' +
        'i - углы падения/преломления\n' +
        'V - скорости в слоях\n' +
        '```\n\n' +
        
        '**Условие преломления:**\n' +
        'V₂ > V₁ (скорость увеличивается с глубиной)\n\n' +
        
        '**Критический угол:**\n' +
        '```\n' +
        'sin(ic) = V₁ / V₂\n' +
        '```\n\n' +
        
        '**3. ПОЛЕВЫЕ РАБОТЫ:**\n\n' +
        
        '**Расстановка оборудования:**\n' +
        '- Профиль: прямая линия\n' +
        '- Геофоны: 12-24 канала\n' +
        '- Расстояние между геофонами: 5-10 м\n' +
        '- Длина профиля: 50-200 м\n' +
        '- Источник возбуждения: кувалда 8-12 кг, взрывные заряды\n\n' +
        
        '**Схема наблюдений:**\n' +
        '- Встречные годографы (с двух концов профиля)\n' +
        '- Точки возбуждения: 0%, 50%, 100% профиля\n' +
        '- Накопление: 3-5 ударов на точку\n\n' +
        
        '**4. ОБРАБОТКА ДАННЫХ:**\n\n' +
        
        '**А. Построение годографов:**\n' +
        '- График t = f(x), где t - время, x - расстояние\n' +
        '- Выделение прямолинейных участков (слои)\n' +
        '- Определение видимых скоростей по наклону\n\n' +
        
        '**Б. Расчёт глубин (для двухслойной среды):**\n' +
        '```\n' +
        'h = (t₀ × V₁ × V₂) / (2 × √(V₂² - V₁²))\n' +
        '\n' +
        'где:\n' +
        't₀ - время пробега по нормали\n' +
        'V₁ - скорость в первом слое\n' +
        'V₂ - скорость во втором слое\n' +
        '```\n\n' +
        
        '**В. Для многослойной среды:**\n' +
        '- Метод Хэгедорна\n' +
        '- Метод t₀-Δt\n' +
        '- Программное обеспечение (RadExPro, SeisImager)\n\n' +
        
        '**5. ТИПИЧНЫЕ СКОРОСТИ Vp:**\n\n' +
        
        '**Рыхлые грунты:**\n' +
        '- Насыпной грунт: 200-400 м/с\n' +
        '- Супеси, суглинки: 400-800 м/с\n' +
        '- Глины: 800-1500 м/с\n' +
        '- Пески рыхлые: 300-600 м/с\n' +
        '- Пески плотные: 600-1200 м/с\n' +
        '- Гравий, галька: 1000-2000 м/с\n\n' +
        
        '**Скальные грунты:**\n' +
        '- Выветрелые: 1500-2500 м/с\n' +
        '- Малопрочные: 2500-3500 м/с\n' +
        '- Прочные: 3500-5500 м/с\n' +
        '- Граниты, диабазы: 5000-6500 м/с\n\n' +
        
        '**Вода:**\n' +
        '- Подземные воды: 1450-1500 м/с\n' +
        '- Лёд: 3400 м/с\n\n' +
        
        '**6. ОПРЕДЕЛЕНИЕ ДИНАМИЧЕСКИХ МОДУЛЕЙ:**\n\n' +
        
        '**Модуль упругости (динамический):**\n' +
        '```\n' +
        'Ed = ρ × Vp² × (1 + ν) × (1 - 2ν) / (1 - ν)\n' +
        '\n' +
        'где:\n' +
        'ρ - плотность грунта, т/м³\n' +
        'Vp - скорость продольных волн, м/с\n' +
        'ν - коэффициент Пуассона (0.25-0.40)\n' +
        '```\n\n' +
        
        '**Модуль сдвига:**\n' +
        '```\n' +
        'G = ρ × Vs²\n' +
        '\n' +
        'где Vs - скорость поперечных волн\n' +
        'Vs = Vp / √((2 - 2ν) / (1 - 2ν))\n' +
        '```\n\n' +
        
        '**7. ГЛУБИННОСТЬ ИССЛЕДОВАНИЙ:**\n' +
        '- Зависит от длины профиля L\n' +
        '- Правило: hmax ≈ L / 5\n' +
        '- Для L = 100 м → hmax ≈ 20 м\n' +
        '- Для глубоких исследований: L = 200-500 м\n\n' +
        
        '**8. КОЛИЧЕСТВО ПРОФИЛЕЙ:**\n\n' +
        
        '**Для площадных объектов:**\n' +
        '- Сеть профилей: 100×100 м или 50×50 м\n' +
        '- Минимум 2-3 профиля на объект\n' +
        '- Взаимно перпендикулярные\n\n' +
        
        '**Для линейных объектов:**\n' +
        '- Вдоль оси трассы\n' +
        '- Поперечные профили через 200-500 м\n\n' +
        
        '**9. ПРЕИМУЩЕСТВА МПВ:**\n' +
        '- Высокая производительность (2-5 км/день)\n' +
        '- Непрерывность разреза\n' +
        '- Определение динамических свойств\n' +
        '- Работа в любое время года\n' +
        '- Неразрушающий метод\n\n' +
        
        '**10. ОГРАНИЧЕНИЯ:**\n' +
        '- Требует возрастания скорости с глубиной\n' +
        '- Не выявляет инверсии (мягкие слои под жёсткими)\n' +
        '- Сложность в городских условиях (шумы)\n' +
        '- Необходима калибровка по скважинам\n\n' +
        
        '**ПРИМЕНЕНИЕ:**\n' +
        '- Поиск скальных грунтов под фундаменты\n' +
        '- Картирование кровли коренных пород\n' +
        '- Оценка сейсмической жёсткости площадки\n' +
        '- Проектирование трасс дорог и трубопроводов\n' +
        '- Оценка толщины рыхлых отложений',
      
      recommendedValues: {
        profileLength: {
          value: 100,
          unit: 'м',
          explanation: 'Стандартная длина профиля'
        },
        numberOfProfiles: {
          value: 3,
          unit: 'профилей',
          explanation: 'Минимум на объект'
        }
      }
    }
  ],
  
  calculateValues: (input: GeologicalInput) => {
    const area = input.buildingArea || 0;
    const linear = input.linearLength || 0;
    
    let profilesCount = 2;
    let profileLength = 100;
    
    if (area > 0) {
      // Площадной объект
      profilesCount = Math.max(2, Math.ceil(Math.sqrt(area / 10000)) * 2);
      profileLength = Math.min(200, Math.sqrt(area));
    } else if (linear > 0) {
      // Линейный объект
      profilesCount = Math.ceil(linear / 500);
      profileLength = 100;
    }
    
    const totalLength = profilesCount * profileLength;
    
    return {
      seismicProfiles: {
        value: profilesCount,
        unit: 'профилей',
        explanation: 'Количество сейсмопрофилей МПВ',
        confidence: 85
      },
      totalLength: {
        value: totalLength,
        unit: 'п.м',
        explanation: 'Общая длина профилирования',
        confidence: 85
      }
    };
  },
  
  generateWorks: (input: GeologicalInput) => {
    const works: WorkItem[] = [];
    const values = block_44_01_seismic_refraction.calculateValues!(input);
    
    const length = typeof values.totalLength.value === 'number'
      ? values.totalLength.value
      : parseFloat(String(values.totalLength.value));
    
    works.push({
      workId: 'GEOPH-SEIS-01',
      name: 'Сейсморазведка методом преломленных волн (МПВ)',
      description: 
        'Полевые работы: возбуждение, приём, регистрация. ' +
        'Обработка: построение годографов, расчёт глубин, скоростей Vp',
      unit: 'п.м',
      quantity: length,
      category: 'recommended',
      module: 'geological',
      priority: 'РЕКОМЕНДУЕМЫЙ',
      normativeBase: 'СП РК 1.02-102-2014, п. 9.3',
      tags: ['геофизика', 'сейсморазведка'],
      priceTableCode: '1602-0601'
    });
    
    return works;
  }
};

export const section44_blocks: InstructionBlock[] = [
  block_44_01_seismic_refraction
];

export default section44_blocks;
