/**
 * Файл: section22-pressuremeter-tests.ts
 * Назначение: Прессиометрические испытания
 */

import type { 
  InstructionBlock, 
  GeologicalInput, 
  WorkItem 
} from './types';

/**
 * Блок 22.1: Прессиометрия
 */
export const block_22_01_pressuremeter: InstructionBlock = {
  id: 'block-22-01-pressuremeter',
  section: 'Раздел 22: Прессиометрия',
  title: 'Прессиометрические испытания в скважинах',
  description: 'Определение модуля деформации и предельного давления',
  priority: 38,
  tags: ['полевые', 'прессиометр', 'скважинные'],
  
  condition: (input: GeologicalInput) => {
    return (input.geotechnicalCategory === 'III' ||
            input.numberOfFloors >= 16) &&
           input.soilTypes?.includes('глинистые');
  },
  
  variants: [
    {
      id: 'variant-pressuremeter-standard',
      priority: 'РЕКОМЕНДУЕМЫЙ',
      normative: {
        document: 'ГОСТ 20276-2012',
        section: 'Прессиометрические испытания',
        priority: 'РЕКОМЕНДУЕМЫЙ'
      },
      recommendation:
        '**ПРЕССИОМЕТРИЧЕСКИЕ ИСПЫТАНИЯ:**\n\n' +
        
        '**1. ПРИНЦИП РАБОТЫ:**\n' +
        '- Расширение цилиндрической камеры в скважине\n' +
        '- Измерение давления и радиального перемещения стенок\n' +
        '- Испытания ненарушенного массива\n' +
        '- Глубина: до 30-50 м\n\n' +
        
        '**2. ТИПЫ ПРЕССИОМЕТРОВ:**\n\n' +
        
        '**А. Прессиометр Менара (PMT):**\n' +
        '- Цилиндрическая резиновая камера\n' +
        '- Диаметр: 58-76 мм\n' +
        '- Длина: 210-420 мм\n' +
        '- Раздув водой или газом\n' +
        '- Измерение объёма вытесненной жидкости\n\n' +
        
        '**Б. Самобуримый прессиометр (SBPMT):**\n' +
        '- Погружается с одновременным бурением\n' +
        '- Минимальное нарушение грунта\n' +
        '- Более точные результаты\n\n' +
        
        '**В. Полноразмещающийся (FPMT):**\n' +
        '- Опускается в предварительно пробуренную скважину\n' +
        '- Простота установки\n' +
        '- Больше нарушение грунта\n\n' +
        
        '**3. МЕТОДИКА ИСПЫТАНИЙ:**\n\n' +
        
        '**Подготовка:**\n' +
        '- Бурение скважины диаметром 76-100 мм\n' +
        '- Опускание прессиометра на заданную глубину\n' +
        '- Выжидание стабилизации (30 мин)\n\n' +
        
        '**Нагружение:**\n' +
        '- Ступенчатое увеличение давления\n' +
        '- Ступени: 50-100 кПа\n' +
        '- Выдержка: 30-60 секунд на ступень\n' +
        '- До разрушения грунта или Pmax\n\n' +
        
        '**Запись:**\n' +
        '- Давление P (кПа)\n' +
        '- Объём V (см³) или радиальная деформация ΔR\n\n' +
        
        '**4. ОБРАБОТКА РЕЗУЛЬТАТОВ:**\n\n' +
        
        '**График P-V (прессиометрическая кривая):**\n' +
        '- Фаза I: Восстановление контакта (нелинейная)\n' +
        '- Фаза II: Псевдоупругая деформация (линейная)\n' +
        '- Фаза III: Пластическое течение (нелинейная)\n\n' +
        
        '**Характерные давления:**\n' +
        '```\n' +
        'P₀ - начальное давление покоя\n' +
        'Pf - давление текучести (начало пластичности)\n' +
        'Pl - предельное давление (разрушение)\n' +
        '```\n\n' +
        
        '**Прессиометрический модуль:**\n' +
        '```\n' +
        'EM = 2 × (1 + ν) × V₀ × (ΔP / ΔV)\n' +
        '\n' +
        'где:\n' +
        'V₀ - начальный объём камеры\n' +
        'ΔP - приращение давления в линейной зоне\n' +
        'ΔV - приращение объёма\n' +
        'ν - коэффициент Пуассона\n' +
        '```\n\n' +
        
        '**Модуль деформации:**\n' +
        '```\n' +
        'E = α × EM\n' +
        '\n' +
        'где α - коэффициент корреляции:\n' +
        'α = 0.33 для глин\n' +
        'α = 0.50 для суглинков\n' +
        'α = 0.67 для песков\n' +
        '```\n\n' +
        
        '**5. ТИПИЧНЫЕ ЗНАЧЕНИЯ EM:**\n\n' +
        
        '**Глинистые грунты:**\n' +
        '- Глины текучие: EM = 2-5 МПа\n' +
        '- Глины мягкопластичные: EM = 5-15 МПа\n' +
        '- Глины тугопластичные: EM = 15-40 МПа\n' +
        '- Глины полутвёрдые: EM = 40-100 МПа\n\n' +
        
        '**Песчаные грунты:**\n' +
        '- Пески рыхлые: EM = 10-20 МПа\n' +
        '- Пески средней плотности: EM = 20-40 МПа\n' +
        '- Пески плотные: EM = 40-80 МПа\n\n' +
        
        '**6. НЕСУЩАЯ СПОСОБНОСТЬ:**\n' +
        '```\n' +
        'qu = Pl - P₀    (прессиометрическая прочность)\n' +
        '```\n\n' +
        
        '**7. ПРЕИМУЩЕСТВА:**\n' +
        '- Испытания на любой глубине\n' +
        '- Испытания в естественном залегании\n' +
        '- Не требуется отбор образцов\n' +
        '- Определение E и прочности одновременно\n' +
        '- Быстрота (15-30 мин на точку)\n' +
        '- Подходит для слабых грунтов\n\n' +
        
        '**8. НЕДОСТАТКИ:**\n' +
        '- Сложность оборудования\n' +
        '- Зависимость от качества скважины\n' +
        '- Малая зона испытаний (~3-5 диаметров)\n' +
        '- Нарушение грунта при бурении\n\n' +
        
        '**9. КОЛИЧЕСТВО ИСПЫТАНИЙ:**\n' +
        '- 3-5 точек по глубине в одной скважине\n' +
        '- 2-3 скважины на объект\n' +
        '- Всего: 6-15 определений\n\n' +
        
        '**10. ПРИМЕНЕНИЕ:**\n' +
        '- Высотные здания (>16 этажей)\n' +
        '- Глубокие котлованы\n' +
        '- Слабые глинистые грунты\n' +
        '- Контроль улучшения грунтов\n' +
        '- Европейская практика (EN ISO 22476-4)\n\n' +
        
        '**ВАЖНО:** Прессиометр незаменим для слабых глин (IL > 0.5)',
      
      recommendedValues: {
        pointsPerBorehole: {
          value: 4,
          unit: 'точек',
          explanation: 'Испытания по глубине в одной скважине'
        },
        numberOfBoreholes: {
          value: 2,
          unit: 'скважин',
          explanation: 'Минимум на объект'
        }
      }
    }
  ],
  
  calculateValues: (input: GeologicalInput) => {
    // Прессиометр для ответственных объектов
    const boreholes = 2;
    const pointsPerBorehole = 4;
    const totalPoints = boreholes * pointsPerBorehole;
    
    return {
      pressuremeterTests: {
        value: totalPoints,
        unit: 'точек',
        explanation: 'Прессиометрические испытания',
        confidence: 85
      },
      boreholes: {
        value: boreholes,
        unit: 'скважин',
        explanation: 'Скважины для прессиометрии',
        confidence: 90
      }
    };
  },
  
  generateWorks: (input: GeologicalInput) => {
    const works: WorkItem[] = [];
    const values = block_22_01_pressuremeter.calculateValues!(input);
    
    const qty = typeof values.pressuremeterTests.value === 'number'
      ? values.pressuremeterTests.value
      : parseInt(String(values.pressuremeterTests.value));
    
    works.push({
      workId: 'FIELD-PRESS-01',
      name: 'Прессиометрические испытания грунтов',
      description: 
        'Испытания прессиометром Менара в скважинах. ' +
        'Определение прессиометрического модуля EM, модуля деформации E, ' +
        'предельного давления Pl',
      unit: 'точка',
      quantity: qty,
      category: 'recommended',
      module: 'geological',
      priority: 'РЕКОМЕНДУЕМЫЙ',
      normativeBase: 'ГОСТ 20276-2012',
      tags: ['полевые', 'прессиометр', 'модуль'],
      priceTableCode: '1602-0407'
    });
    
    return works;
  }
};

export const section22_blocks: InstructionBlock[] = [
  block_22_01_pressuremeter
];

export default section22_blocks;
