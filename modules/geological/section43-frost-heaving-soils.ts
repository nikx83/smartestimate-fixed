/**
 * Файл: section43-frost-heaving-soils.ts
 * Назначение: Исследование пучинистых (морозоопасных) грунтов
 */

import type { 
  InstructionBlock, 
  GeologicalInput, 
  WorkItem 
} from './types';

/**
 * Блок 43.1: Выявление пучинистых грунтов
 */
export const block_43_01_frost_heaving: InstructionBlock = {
  id: 'block-43-01-frost-heaving',
  section: 'Раздел 43: Пучинистые грунты',
  title: 'Исследование морозного пучения грунтов',
  description: 'Определение степени пучинистости',
  priority: 29,
  tags: ['специфические', 'пучинистые', 'морозное-пучение'],
  
  condition: (input: GeologicalInput) => {
    return input.climateZone === 'холодный' ||
           input.seasonalFreezing === true ||
           input.region === 'Северный Казахстан' ||
           input.region === 'Восточный Казахстан';
  },
  
  variants: [
    {
      id: 'variant-frost-heaving-full',
      priority: 'ОБЯЗАТЕЛЬНЫЙ',
      normative: {
        document: 'СП РК 2.02-03-2018',
        section: 'Строительство в сезонно-промерзающих грунтах',
        priority: 'ОБЯЗАТЕЛЬНЫЙ'
      },
      recommendation:
        '**ИССЛЕДОВАНИЕ МОРОЗНОГО ПУЧЕНИЯ:**\n\n' +
        
        '**1. ФАКТОРЫ ПУЧИНИСТОСТИ:**\n' +
        '- Гранулометрический состав (пылеватые фракции)\n' +
        '- Влажность грунта\n' +
        '- Глубина промерзания\n' +
        '- Уровень грунтовых вод\n' +
        '- Скорость промерзания\n\n' +
        
        '**2. ОЦЕНКА СТЕПЕНИ ПУЧИНИСТОСТИ:**\n\n' +
        
        '**А. По относительной деформации пучения εfh:**\n' +
        '```\n' +
        'εfh = (hf - h₀) / h₀\n' +
        '\n' +
        'где:\n' +
        'hf - высота образца после промерзания\n' +
        'h₀ - начальная высота образца\n' +
        '```\n\n' +
        
        '**Классификация:**\n' +
        '- Непучинистые: εfh < 0.01\n' +
        '- Слабопучинистые: 0.01 ≤ εfh < 0.035\n' +
        '- Среднепучинистые: 0.035 ≤ εfh < 0.07\n' +
        '- Сильнопучинистые: εfh ≥ 0.07\n\n' +
        
        '**Б. По гранулометрическому составу (предварительная оценка):**\n\n' +
        '**Непучинистые:**\n' +
        '- Пески гравелистые, крупные, средней крупности\n' +
        '- Крупнообломочные грунты\n\n' +
        
        '**Слабопучинистые:**\n' +
        '- Пески мелкие\n' +
        '- Супеси легкие крупные\n\n' +
        
        '**Среднепучинистые:**\n' +
        '- Пески пылеватые\n' +
        '- Супеси легкие\n' +
        '- Суглинки легкие (Ip = 7-12%)\n\n' +
        
        '**Сильнопучинистые:**\n' +
        '- Супеси тяжелые пылеватые\n' +
        '- Суглинки тяжелые (Ip = 12-17%)\n' +
        '- Глины (Ip > 17%)\n\n' +
        
        '**3. ЛАБОРАТОРНЫЕ ИСПЫТАНИЯ:**\n\n' +
        
        '**А. Испытание на морозное пучение:**\n' +
        '- Цилиндрические образцы ненарушенного сложения\n' +
        '- Диаметр 50-100 мм, высота 100-150 мм\n' +
        '- Охлаждение до -10...-15°C\n' +
        '- Подпитка водой снизу\n' +
        '- Измерение высоты образца при промерзании\n' +
        '- Продолжительность: 48-72 часа\n\n' +
        
        '**Б. Влажность и плотность:**\n' +
        '- Природная влажность W\n' +
        '- Плотность ρ\n' +
        '- Степень влажности Sr\n\n' +
        
        '**4. РАСЧЁТ МОРОЗНОГО ПУЧЕНИЯ ОСНОВАНИЯ:**\n\n' +
        
        '**Глубина промерзания df:**\n' +
        '```\n' +
        'df = df,n × kh\n' +
        '\n' +
        'где:\n' +
        'df,n - нормативная глубина промерзания по климатическим картам\n' +
        'kh - коэффициент теплового режима здания\n' +
        '```\n\n' +
        
        '**Нормативная глубина по регионам РК:**\n' +
        '- Северный Казахстан: 1.6-2.2 м\n' +
        '- Восточный Казахстан: 1.8-2.5 м\n' +
        '- Центральный Казахстан: 1.2-1.8 м\n' +
        '- Южный Казахстан: 0.6-1.2 м\n\n' +
        
        '**Суммарное пучение основания:**\n' +
        '```\n' +
        'Hfh = Σ(hi × εfh,i)\n' +
        '\n' +
        'где:\n' +
        'hi - мощность i-го слоя в пределах промерзания\n' +
        'εfh,i - относительная деформация пучения i-го слоя\n' +
        '```\n\n' +
        
        '**5. ПРОТИВОПУЧИННЫЕ МЕРОПРИЯТИЯ:**\n\n' +
        
        '**А. Конструктивные:**\n' +
        '- Заглубление фундаментов ниже глубины промерзания\n' +
        '- Применение свайных фундаментов с анкеровкой\n' +
        '- Утепленные отмостки и приямки\n' +
        '- Гибкие деформационные швы\n\n' +
        
        '**Б. Теплофизические:**\n' +
        '- Теплоизоляция грунтов основания (пенополистирол)\n' +
        '- Уменьшение глубины промерзания\n' +
        '- Вентилируемые подполья\n\n' +
        
        '**В. Гидротехнические:**\n' +
        '- Понижение УГВ дренажом\n' +
        '- Отвод поверхностных вод\n' +
        '- Гидроизоляция фундаментов\n\n' +
        
        '**Г. Грунтовые:**\n' +
        '- Замена пучинистого грунта на непучинистый (песок, щебень)\n' +
        '- Обратные засыпки непучинистым материалом\n' +
        '- Химическая стабилизация (соли, битум)\n\n' +
        
        '**6. ПОЛЕВЫЕ НАБЛЮДЕНИЯ:**\n' +
        '- Замер глубины промерзания реечным мерзлотомером\n' +
        '- Температурные датчики на разных глубинах\n' +
        '- Наблюдения за деформациями реперов\n' +
        '- Продолжительность: зимний период\n\n' +
        
        '**7. КАСАТЕЛЬНЫЕ СИЛЫ МОРОЗНОГО ПУЧЕНИЯ:**\n' +
        '```\n' +
        'τfh = 30-120 кПа (для глинистых грунтов)\n' +
        'τfh = 20-60 кПа (для супесей)\n' +
        '```\n' +
        '- Действуют на боковую поверхность фундаментов\n' +
        '- Могут вырывать легкие конструкции\n\n' +
        
        '**8. КОЛИЧЕСТВО ИСПЫТАНИЙ:**\n' +
        '- 3-6 определений εfh на каждый ИГЭ\n' +
        '- Полевые наблюдения: 2-3 скважины с мерзлотомерами\n' +
        '- Температурные датчики: 3-5 точек\n\n' +
        
        '**ВАЖНО:** Пучение зависит от УГВ. При УГВ глубже (df + 2м) пучение минимально',
      
      recommendedValues: {
        frostTests: {
          value: 4,
          unit: 'испытаний',
          explanation: 'На каждый ИГЭ'
        },
        fieldObservations: {
          value: 2,
          unit: 'точки',
          explanation: 'Полевые наблюдения за промерзанием'
        }
      }
    }
  ],
  
  calculateValues: (input: GeologicalInput) => {
    const layers = input.expectedIGE || 2;
    const testsPerLayer = 4;
    
    return {
      frostHeavingTests: {
        value: layers * testsPerLayer,
        unit: 'испытаний',
        explanation: 'Определение относительной деформации пучения',
        confidence: 90
      },
      fieldMonitoring: {
        value: 2,
        unit: 'точек',
        explanation: 'Полевые наблюдения за промерзанием',
        confidence: 85
      },
      freezingDepth: {
        value: input.regionFrostDepth || 1.5,
        unit: 'м',
        explanation: 'Расчетная глубина промерзания',
        confidence: 95
      }
    };
  },
  
  generateWorks: (input: GeologicalInput) => {
    const works: WorkItem[] = [];
    const values = block_43_01_frost_heaving.calculateValues!(input);
    
    const testQty = typeof values.frostHeavingTests.value === 'number'
      ? values.frostHeavingTests.value
      : parseInt(String(values.frostHeavingTests.value));
    
    const monQty = typeof values.fieldMonitoring.value === 'number'
      ? values.fieldMonitoring.value
      : parseInt(String(values.fieldMonitoring.value));
    
    works.push({
      workId: 'SPEC-FROST-01',
      name: 'Испытания грунтов на морозное пучение',
      description: 
        'Лабораторное определение относительной деформации пучения εfh ' +
        'в климатической камере с подпиткой водой',
      unit: 'испытание',
      quantity: testQty,
      category: 'mandatory',
      module: 'geological',
      priority: 'ОБЯЗАТЕЛЬНЫЙ',
      normativeBase: 'ГОСТ 28622-2012',
      tags: ['специфические', 'пучинистые', 'лаборатория'],
      priceTableCode: '1602-0712'
    });
    
    works.push({
      workId: 'SPEC-FROST-02',
      name: 'Полевые наблюдения за промерзанием грунтов',
      description: 
        'Установка мерзлотомеров, температурных датчиков. ' +
        'Замеры глубины промерзания в течение зимнего периода',
      unit: 'точка',
      quantity: monQty,
      category: 'recommended',
      module: 'geological',
      priority: 'РЕКОМЕНДУЕМЫЙ',
      normativeBase: 'СП РК 2.02-03-2018',
      tags: ['специфические', 'пучинистые', 'мониторинг'],
      priceTableCode: '1602-0404'
    });
    
    return works;
  }
};

export const section43_blocks: InstructionBlock[] = [
  block_43_01_frost_heaving
];

export default section43_blocks;
