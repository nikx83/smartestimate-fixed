/**
 * Файл: section42-saline-soils.ts
 * Назначение: Исследование засоленных грунтов
 */

import type { 
  InstructionBlock, 
  GeologicalInput, 
  WorkItem 
} from './types';

/**
 * Блок 42.1: Выявление засоленных грунтов
 */
export const block_42_01_saline_identification: InstructionBlock = {
  id: 'block-42-01-saline-id',
  section: 'Раздел 42: Засоленные грунты',
  title: 'Выявление и исследование засоленных грунтов',
  description: 'Определение степени и типа засоления',
  priority: 28,
  tags: ['специфические', 'засоленные', 'химия'],
  
  condition: (input: GeologicalInput) => {
    return input.region === 'Западный Казахстан' ||
           input.region === 'Аральская зона' ||
           input.region === 'Прикаспийская низменность' ||
           input.hasSalineRisk === true;
  },
  
  variants: [
    {
      id: 'variant-saline-full',
      priority: 'ОБЯЗАТЕЛЬНЫЙ',
      normative: {
        document: 'ГОСТ 25100-2020',
        section: 'Засоленные грунты',
        priority: 'ОБЯЗАТЕЛЬНЫЙ'
      },
      recommendation:
        '**ИССЛЕДОВАНИЕ ЗАСОЛЕННЫХ ГРУНТОВ:**\n\n' +
        
        '**1. ОПРЕДЕЛЕНИЕ ЗАСОЛЕННОСТИ:**\n\n' +
        
        '**А. Общая степень засоления:**\n' +
        'По содержанию легкорастворимых солей (сухой остаток водной вытяжки 1:5):\n' +
        '- Незасоленные: <0.3%\n' +
        '- Слабозасоленные: 0.3-0.5%\n' +
        '- Среднезасоленные: 0.5-1.0%\n' +
        '- Сильнозасоленные: 1.0-2.0%\n' +
        '- Солончаки: >2.0%\n\n' +
        
        '**Б. Тип засоления:**\n' +
        'По преобладающему аниону:\n' +
        '- Сульфатное (SO₄²⁻ > 50%)\n' +
        '- Хлоридное (Cl⁻ > 50%)\n' +
        '- Содовое (CO₃²⁻ + HCO₃⁻ > 50%)\n' +
        '- Смешанное\n\n' +
        
        '**В. Засоленность по катионам:**\n' +
        '- Натриевое (Na⁺ > 50%)\n' +
        '- Магниевое (Mg²⁺ > 50%)\n' +
        '- Кальциевое (Ca²⁺ > 50%)\n\n' +
        
        '**2. ХИМИЧЕСКИЙ АНАЛИЗ ВОДНОЙ ВЫТЯЖКИ:**\n\n' +
        
        '**Определяемые параметры:**\n' +
        '- Сухой остаток (общая минерализация)\n' +
        '- pH среды\n' +
        '- Анионы: SO₄²⁻, Cl⁻, HCO₃⁻, CO₃²⁻\n' +
        '- Катионы: Ca²⁺, Mg²⁺, Na⁺+K⁺\n' +
        '- Токсичные соли: гипс (CaSO₄), мирабилит (Na₂SO₄)\n\n' +
        
        '**3. ВЛИЯНИЕ НА СТРОИТЕЛЬНЫЕ СВОЙСТВА:**\n\n' +
        
        '**А. Прочностные характеристики:**\n' +
        '```\n' +
        'При засолении >2%:\n' +
        '- Угол трения φ снижается на 2-4°\n' +
        '- Сцепление c снижается на 20-30%\n' +
        '- Модуль деформации E снижается на 15-25%\n' +
        '```\n\n' +
        
        '**Б. Растворение солей:**\n' +
        '- При инфильтрации воды → выщелачивание солей\n' +
        '- Образование суффозионных полостей\n' +
        '- Просадки грунта\n' +
        '- Неравномерные деформации\n\n' +
        
        '**В. Коррозионная активность:**\n' +
        '- Сульфатное засоление → высокая агрессивность к бетону\n' +
        '- Хлоридное засоление → коррозия арматуры\n' +
        '- Содовое засоление → агрессия к бетону и металлам\n\n' +
        
        '**4. СПЕЦИАЛЬНЫЕ ИСПЫТАНИЯ:**\n\n' +
        
        '**А. Испытания на растворимость:**\n' +
        '- Образцы с природным засолением\n' +
        '- Замачивание дистиллированной водой\n' +
        '- Измерение деформаций при выщелачивании\n' +
        '- Определение относительной суффозионности εss\n\n' +
        
        '**Б. Компрессионные испытания:**\n' +
        '- При природной влажности\n' +
        '- После полного выщелачивания солей\n' +
        '- Сравнение модулей деформации\n\n' +
        
        '**5. ПРОТИВОСОЛЕВЫЕ МЕРОПРИЯТИЯ:**\n\n' +
        
        '**При слабом засолении (0.3-0.5%):**\n' +
        '- Водозащитные мероприятия (отмостка, гидроизоляция)\n' +
        '- Дренаж для отвода поверхностных вод\n\n' +
        
        '**При среднем/сильном засолении (>0.5%):**\n' +
        '- Промывка грунтов с последующим дренированием\n' +
        '- Замена засоленного грунта\n' +
        '- Химическая стабилизация\n' +
        '- Глубокие фундаменты (сваи в незасоленные слои)\n' +
        '- Использование сульфатостойких цементов\n' +
        '- Усиленная гидроизоляция\n\n' +
        
        '**6. КОЛИЧЕСТВО АНАЛИЗОВ:**\n' +
        '- 3-6 анализов на каждый засоленный ИГЭ\n' +
        '- По глубинам: 0-1м, 1-3м, 3-5м, 5-10м\n' +
        '- Дополнительно: зона сезонного промачивания\n\n' +
        
        '**7. МОНИТОРИНГ ЗАСОЛЕНИЯ:**\n' +
        '- При орошении территории\n' +
        '- Периодический контроль УГВ\n' +
        '- Повторные химические анализы (раз в год)\n\n' +
        
        '**ВАЖНО:** Засоление изменяется со временем под влиянием климата и антропогенных факторов',
      
      recommendedValues: {
        chemicalAnalyses: {
          value: 4,
          unit: 'анализов',
          explanation: 'На каждый ИГЭ по глубине'
        },
        solubilityTests: {
          value: 2,
          unit: 'испытаний',
          explanation: 'Испытания на растворимость'
        }
      }
    }
  ],
  
  calculateValues: (input: GeologicalInput) => {
    const salineLayers = input.expectedIGE || 2;
    const depthLevels = 4; // 0-1, 1-3, 3-5, 5-10м
    const analysesTotal = salineLayers * depthLevels;
    
    return {
      chemicalAnalyses: {
        value: analysesTotal,
        unit: 'анализов',
        explanation: 'Определение степени и типа засоления',
        confidence: 90
      },
      solubilityTests: {
        value: 2,
        unit: 'испытаний',
        explanation: 'Испытания на растворимость и суффозию',
        confidence: 85
      }
    };
  },
  
  generateWorks: (input: GeologicalInput) => {
    const works: WorkItem[] = [];
    const values = block_42_01_saline_identification.calculateValues!(input);
    
    const chemQty = typeof values.chemicalAnalyses.value === 'number'
      ? values.chemicalAnalyses.value
      : parseInt(String(values.chemicalAnalyses.value));
    
    const solQty = typeof values.solubilityTests.value === 'number'
      ? values.solubilityTests.value
      : parseInt(String(values.solubilityTests.value));
    
    works.push({
      workId: 'SPEC-SALINE-01',
      name: 'Химический анализ засоленных грунтов',
      description: 
        'Определение сухого остатка, типа засоления (SO₄²⁻, Cl⁻, CO₃²⁻), ' +
        'катионного состава. Оценка агрессивности к бетону',
      unit: 'анализ',
      quantity: chemQty,
      category: 'mandatory',
      module: 'geological',
      priority: 'ОБЯЗАТЕЛЬНЫЙ',
      normativeBase: 'ГОСТ 25100-2020, ГОСТ 23740-2016',
      tags: ['специфические', 'засоленные', 'химия'],
      priceTableCode: '1602-0705'
    });
    
    works.push({
      workId: 'SPEC-SALINE-02',
      name: 'Испытания засоленных грунтов на растворимость',
      description: 
        'Определение суффозионности при выщелачивании солей',
      unit: 'испытание',
      quantity: solQty,
      category: 'mandatory',
      module: 'geological',
      priority: 'ОБЯЗАТЕЛЬНЫЙ',
      normativeBase: 'ГОСТ 25100-2020',
      tags: ['специфические', 'засоленные'],
      priceTableCode: '1602-0711'
    });
    
    return works;
  }
};

export const section42_blocks: InstructionBlock[] = [
  block_42_01_saline_identification
];

export default section42_blocks;
